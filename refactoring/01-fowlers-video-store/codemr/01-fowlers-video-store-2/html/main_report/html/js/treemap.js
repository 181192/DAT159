function paintCallBack(){rects.style("fill",function(t){return EQ_GET_COLOR(t)})}window.onload=function(){EQ_addComboItems("ClassMSel")};var root,node,w=1200,h=620,x=d3.scale.linear().range([0,w]),y=d3.scale.linear().range([0,h]),color=d3.scale.category20c(),treemap=d3.layout.treemap().round(!1).size([w,h]).sticky(!0).value(function(t){return t.value}),svg=d3.select("#mainchartbody").append("div").attr("class","treemapchart").style("width",w+"px").style("height",h+"px").append("svg:svg").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate(.5,.5)");root=EQ_GET_DATA(),node=root;var nodes=treemap.nodes(root),cell=svg.selectAll("g").data(nodes).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return zoom(node==t.parent?root:t.parent)}).on("mousemove",function(t){return mousemove(t)}).on("mouseout",function(t){return mouseout(t)}),rects=cell.append("svg:rect");rects.attr("class","treerect").attr("width",function(t){return 1<t.dx?t.dx-1:0}).attr("height",function(t){return 1<t.dy?t.dy-1:0}).style("fill-opacity",function(t){return t.children?0:.8}).style("fill",function(t){return EQ_GET_COLOR(t)}).style("stroke",function(t){return t.children?"#000000":"none"}).style("stroke-width",function(t){return t.children?2:0}),cell.append("svg:text").attr("class","treemaptext").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.h=this.clientHeight,0==t.depth||1==t.depth?0:0!=node.depth||t.children?t.h>t.dy?0:t.dx>t.w?1:0:0});var packageNodes=treemap.nodes(root).filter(function(t){return 1==t.depth}),packageNodesText=svg.selectAll("g2").data(packageNodes).enter().append("svg:text").attr("class","packageNodesText").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.h=this.clientHeight,0!=node.depth||t.children?t.h>t.dy?0:t.dx>t.w?1:0:0});function zoom(t){var e=w/t.dx,n=h/t.dy;x.domain([t.x,t.x+t.dx]),y.domain([t.y,t.y+t.dy]),node=t;var o=svg.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+x(t.x)+","+y(t.y)+")"});o.select("rect").attr("width",function(t){return e*t.dx-1}).attr("height",function(t){var e=n*t.dy-1;return 0<e?e:0}),o.select("text").attr("x",function(t){return e*t.dx/2}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return 0!=node.depth||t.children?0==t.depth||1==t.depth?0:t.h>t.dy*n?0:e*t.dx>t.w?1:0:0}),svg.selectAll(".packageNodesText").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+x(t.x)+","+y(t.y)+")"}).style("opacity",function(t){return 0!=node.depth?0:t.h>t.dy*n?0:e*t.dx>t.w?1:0}),d3.event.stopPropagation()}d3.select(window).on("click",function(){zoom(root)});var last=null,mousemove=function(t){elem=document.getElementsByClassName("treemapchart"),boundingRect=elem[0].getBoundingClientRect();var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=d3.event.pageX,r=d3.event.pageY;d3.event.pageX>boundingRect.left+w/2?(d3.select("#tooltip").style("right",e-o+"px"),d3.select("#tooltip").style("left","auto")):(d3.select("#tooltip").style("left",o+"px"),d3.select("#tooltip").style("right","auto")),d3.event.pageY>boundingRect.top+h/2?(d3.select("#tooltip").style("bottom",n-r+"px"),d3.select("#tooltip").style("top","auto")):(d3.select("#tooltip").style("top",r+"px"),d3.select("#tooltip").style("bottom","auto")),d3.select("#tooltip #parent").text(t.parent.name),d3.select("#tooltip #name").text(t.name),d3.select("#tooltip #metricvalue").text(EQ_getSelectedMetricName(t)+" : "+EQ_GET_METRICVALUE(t)),d3.select("#tooltip").classed("hidden",!1),last!==t&&t.metrics&&(eQ.MetricChart.updateDots(EQ_convertMetricValues(t.metricvalues)),last=t,"function"==typeof updateSelectedElement&&updateSelectedElement(t.parent?t.parent.name:"",t.key))},mouseout=function(t){d3.select("#tooltip").classed("hidden",!0)};
