var OPTION_SHOW_TOOLTIP_ONCORNER=!1,OPTION_HIDE_LABELS=!1,OPTION_HIGHLIGHT_ONHOVER=!1,OPTION_SKIP_DOT_COUNT=1,OPTION_MAX_TEXT_HEIGHT=14;function paintCallBack(){path.style("fill",function(t){return format_color(t)})}window.onload=function(){EQ_addComboItems("ClassMSel","PackageMSel","ProjectMSel")};var SELF_FRAME_HEIGHT=850,currentDepth=0,currentElement=null,width=800,height=800,radius=Math.min(width,height)/2,x=d3.scale.linear().range([0,2*Math.PI]),y=d3.scale.linear().range([0,radius]),color=d3.scale.category20c(),svg=d3.select("#mainchartbody").append("svg").attr("width",width).attr("height",height).attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 800 800").append("g").attr("transform","translate("+width/2+","+height/2+")"),partition=d3.layout.partition().value(function(t){return t.value}),arc=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,x(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,y(t.y))}).outerRadius(function(t){return Math.max(0,y(t.y+t.dy))});function format_color(t){return EQ_GET_COLOR(t)}function format_name(t){return"<b>"+t.name+"</b><br>"+EQ_getSelectedMetricName(t)+":"+EQ_GET_METRICVALUE(t)+"<br>Level:"+EQ_GET_METRIC_LEVEL_STR(t)}function format_number(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function format_text_visibility(t){return OPTION_HIDE_LABELS?"hidden":currentDepth+1>=t.depth==0?"hidden":null!=currentElement&&0==isParentOf(currentElement,t)?"hidden":Math.max(0,y(t.y))*(Math.min(2*Math.PI,x(t.x+t.dx))-Math.min(2*Math.PI,x(t.x)))<OPTION_MAX_TEXT_HEIGHT?"hidden":"visible"}function getSmartLabel(t){if(currentDepth+1>=t.depth){if(0==OPTION_SKIP_DOT_COUNT)return t.name;var e=t.name,n=e.indexOf(".");if(1==OPTION_SKIP_DOT_COUNT)return e.substring(n+1);var r=e.indexOf(".",n+1);if(2==OPTION_SKIP_DOT_COUNT)return e.substring(r+1);var a=e.indexOf(".",r+1);return e.substring(a+1)}return""}function isParentOf(t,e){return t===e||!!t.children&&t.children.some(function(t){return isParentOf(t,e)})}function pointIsInArc(t,e,n){var r=n.innerRadius()(e),a=n.outerRadius()(e),i=n.startAngle()(e),o=n.endAngle()(e),u=t.x*t.x+t.y*t.y,c=Math.atan2(t.x,-t.y);return c=c<0?c+2*Math.PI:c,r*r<=u&&u<=a*a&&i<=c&&c<=o}var tooltip=d3.select("#tooltipxx");root=EQ_GET_DATA();var g=svg.selectAll("g").data(partition.nodes(root)).enter().append("g");d3.select("g").append("svg:image").attr("x",-78).attr("y",-78).attr("width",156).attr("height",156).on("mouseover",function(){d3.select(this).moveToBack()});var path=g.append("path").attr("d",arc).style("fill",function(t){return format_color(t)}).on("click",click).on("mouseover",doHover).on("mouseout",unDoHover).on("mousemove",doMouseMove),text=g.append("text").attr("text-anchor",function(t){return isRightHalf(t)?"start":"end"}).attr("pointer-events","none").attr("transform",function(t){return"rotate("+computeTextRotation(t)+")translate("+y(t.y)+")rotate("+(isRightHalf(t)?"0":"-180")+")"}).attr("dx",function(t){return isRightHalf(t)?"5":"-5"}).attr("dy",".35em").text(getSmartLabel).style("visibility",function(t){return format_text_visibility(t)}).on("click",click).on("mouseover",doHover).on("mouseout",unDoHover).on("mousemove",doMouseMove);function click(r){currentElement!==r&&(currentDepth=r.depth,currentElement=r,text.transition().attr("opacity",0).style("visibility",function(t){return format_text_visibility(t)}).style("pointer-events","none"),path.transition().duration(750).attrTween("d",arcTween(r)).each("end",function(t,e){if(t.x>=r.x&&t.x<r.x+r.dx){var n=d3.select(this.parentNode).select("text");n.transition().duration(750).attr("opacity",1).attr("text-anchor",function(t){return isRightHalf(t)?"start":"end"}).attr("transform",function(){return"rotate("+computeTextRotation(t)+")translate("+y(t.y)+")rotate("+(isRightHalf(t)?"0":"-180")+")"}).attr("dx",function(t){return isRightHalf(t)?"5":"-5"}),n.text(getSmartLabel).style("visibility",function(t){return format_text_visibility(t)})}}))}function doMouseMove(t){0==OPTION_SHOW_TOOLTIP_ONCORNER&&tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}d3.select("g g").transition().duration(200).attr("opacity","0"),rootShow(),d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})};var last=null;function doHover(t){return OPTION_HIGHLIGHT_ONHOVER&&(d3.select(this.parentNode.childNodes[0]).transition().duration(200).attr("opacity","0.1"),d3.select("g g").transition().duration(200).attr("opacity","0")),tooltip.select("#name").html(function(){return format_name(t)}),last!==t&&(t.metrics&&eQ.MetricChart.updateDots(EQ_convertMetricValues(t.metricvalues)),last=t,"function"==typeof updateSelectedElement&&t.parent&&(t.key?updateSelectedElement(t.parent.name,t.key):updateSelectedElement(t.name,""))),tooltip.transition().duration(50).style("opacity",.9)}function unDoHover(t){return OPTION_HIGHLIGHT_ONHOVER&&(d3.select(this.parentNode.childNodes[0]).select("path").transition().duration(200).attr("opacity","1"),d3.select("g g").transition().duration(200).attr("opacity","0")),tooltip.style("opacity",0)}function rootHide(t){d3.select("g g").transition().duration(200).attr("opacity","0")}function rootShow(t){d3.select("g g").transition().duration(200).attr("opacity","1")}function arcTween(t){var n=d3.interpolate(x.domain(),[t.x,t.x+t.dx]),r=d3.interpolate(y.domain(),[t.y,1]),a=d3.interpolate(y.range(),[t.y?20:0,radius]);return function(e,t){return t?function(t){return arc(e)}:function(t){return x.domain(n(t)),y.domain(r(t)).range(a(t)),arc(e)}}}function computeTextRotation(t){return t===currentElement?0:0==currentDepth&&0==t.depth?0:(x(t.x+t.dx/2)-Math.PI/2)/Math.PI*180}function isRightHalf(t){var e=computeTextRotation(t);return e<0&&(e+=360),!(90<e&&e<=270)}d3.select(self.frameElement).style("height",SELF_FRAME_HEIGHT+"px");
